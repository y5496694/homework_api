# .github/workflows/firebase-deploy.yml

name: Deploy to Firebase Functions

# 이 워크플로우가 언제 실행될지 정의합니다.
# 'main' 브랜치에 push 이벤트가 발생했을 때 실행됩니다.
on:
  push:
    branches:
      - main # main 브랜치 대신 master 등 다른 브랜치 이름을 사용하신다면 수정해주세요.
    paths:
      - 'functions/**' # functions 폴더 내의 파일이 변경되었을 때만 실행

jobs:
  deploy_functions:
    runs-on: ubuntu-latest # 워크플로우를 실행할 가상 환경
    steps:
      # 1. GitHub 저장소의 코드를 가상 환경으로 가져옵니다.
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. functions 폴더로 이동하여 npm 패키지를 설치합니다.
      - name: Install dependencies for functions
        run: |
          cd functions
          npm install

      # 3. Firebase에 배포합니다.
      - name: Deploy to Firebase
        uses: w9jds/firebase-action@master
        with:
          action: deploy
          project: 'mansungcoin-c6e06' # 선생님의 Firebase 프로젝트 ID
          token: ${{ secrets.FIREBASE_TOKEN }} # GitHub Secrets에 저장된 인증 토큰
          args: --only functions # functions만 배포합니다.
        env:
          # 서비스 계정 정보를 환경 변수로 설정합니다.
          # GitHub Secrets에 저장된 서비스 계정 키를 사용합니다.
          FIREBASE_credentials: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_MANSUNGCOIN_C6E06 }}
